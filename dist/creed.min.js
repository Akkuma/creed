!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.creed=t.creed||{})}(this,function(t){"use strict";function e(t){return(t.state()&vt)>0}function n(t){return(t.state()&dt)>0}function r(t){return(t.state()&mt)>0}function o(t){return(t.state()&_t)>0}function i(t){return(t.state()&wt)>0}function c(t){return(t.state()&bt)>0}function u(t){var e=t.near();if(!n(e))throw new TypeError("getValue called on "+t);return e.value}function s(t){var e=t.near();if(!r(e))throw new TypeError("getReason called on "+t);return p(e),e.value}function p(t){t._runAction(gt)}function f(t){t._state|=bt}function h(t){return jt?l(t):At?y(t):a(t)}function a(t){return function(){return setTimeout(t,0)}}function l(t){return function(){return process.nextTick(t)}}function y(t){var e=document.createTextNode("");new At(t).observe(e,{characterData:!0});var n=0;return function(){e.data=n^=1}}function v(t,e){try{d(e,t)}finally{e.length=0}}function d(t,e){for(var n=0;n<t.length;++n){var r=t[n];c(r)||e(r)}}function m(){return jt&&"function"==typeof process.emit?function(t,e){return t===Ot?process.emit(t,e.value,e):process.emit(t,e)}:"undefined"!=typeof self&&"function"==typeof CustomEvent?function(t,e,n){var r;try{r=new n(Ot)instanceof n}catch(t){r=!1}return r?function(t,r){var o=new n(t,{detail:{reason:r.value,promise:r},bubbles:!1,cancelable:!0});return!e.dispatchEvent(o)}:t}(_,self,CustomEvent):_}function _(){}function w(t){return("object"==typeof t||"function"==typeof t)&&null!==t}function b(t,e,n,r){return n._when(new Rt(t,e,r)),r}function g(t,e,n){return"function"!=typeof t?(n._become(e),!1):(j(t,e.value,n),!0)}function j(t,e,n){try{n._resolve(t(e))}catch(t){n._reject(t)}}function A(t,e,n){return e._when(new xt(t,n)),n}function k(t,e,n){return e._when(new St(t,n)),n}function T(t,e,n){var r=t(e);if(!w(r)||"function"!=typeof r.then)throw new TypeError("f must return a promise");n._resolve(r)}function E(t){return Array.isArray(t)?new Array(t.length):[]}function P(t,e,n,r){var o=Array.isArray(n)?O:R;try{o(t,e,n,r)}catch(t){r._reject(t)}return r.near()}function O(t,e,n,r){for(var o=0;o<n.length;++o)x(t,e,n[o],o,r);e.complete(o,r)}function R(t,e,n,r){for(var o=0,i=n[Symbol.iterator]();;){var c=i.next();if(c.done)break;x(t,e,c.value,o++,r)}e.complete(o,r)}function x(t,e,o,i,c){if(!w(o))return void e.valueAt(o,i,c);var u=t(o);c._isResolved()?n(u)||p(u):n(u)?e.fulfillAt(u,i,c):r(u)?e.rejectAt(u,i,c):S(u,e,i,c)}function S(t,e,n,r){t._runAction({handler:e,i:n,promise:r,fulfilled:M,rejected:N})}function M(t){this.handler.fulfillAt(t,this.i,this.promise)}function N(t){return this.handler.rejectAt(t,this.i,this.promise)}function H(t){return B(t)?t.near():w(t)?I(V,t):new Wt(t)}function C(t){return new Dt(t)}function K(){return new Ft}function V(t){return new Wt(t)}function W(){var t=new Vt;return{resolve:function(e){return t._resolve(e)},promise:t}}function D(t){var e=new Nt(qt,E(t));return z(e,t)}function F(t){return z(new Mt(K),t)}function q(t){return"object"==typeof t&&null!==t}function z(t,e){if(!q(e))return C(new TypeError("expected an iterable"));var n=new Vt;return P(G,t,e,n)}function B(t){return t instanceof Kt}function G(t){return B(t)?t.near():I(V,t)}function I(t,e){try{var n=e.then;return"function"==typeof n?J(n,e):t(e)}catch(t){return new Dt(t)}}function J(t,e){var n=new Vt;try{t.call(e,function(t){return n._resolve(t)},function(t){return n._reject(t)})}catch(t){n._reject(t)}return n.near()}function L(){return new Dt(new TypeError("resolution cycle"))}function Q(t,e,n){return e._runAction(new Bt(t,n)),n}function U(t,e){e._become(t)}function X(t,e,n){var r=setTimeout(Y,t,n);return e._runAction(new It(r,n)),n}function Y(t){t._reject(new Gt("promise timeout"))}function Z(t,e,n,r){function o(t){r._resolve(t)}function i(t){r._reject(t)}switch(n.length){case 0:t.call(e,o,i);break;case 1:t.call(e,n[0],o,i);break;case 2:t.call(e,n[0],n[1],o,i);break;case 3:t.call(e,n[0],n[1],n[2],o,i);break;default:n.push(o,i),t.apply(e,n)}return r}function $(t,e,n,r){function o(t,e){t?r._reject(t):r._fulfill(e)}switch(n.length){case 0:t.call(e,o);break;case 1:t.call(e,n[0],o);break;case 2:t.call(e,n[0],n[1],o);break;case 3:t.call(e,n[0],n[1],n[2],o);break;default:n.push(o),t.apply(e,n)}return r}function tt(t,e,n){return new Qt(t,e,n).run(),n}function et(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return nt(t,this,e)}}function nt(t,e,n){var r=t.apply(e,n);return tt(H,r,new Vt)}function rt(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return ct($,t,this,e,new Vt)}}function ot(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return ct($,t,this,e,new Vt)}function it(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return ct(Z,t,this,e,new Vt)}function ct(t,e,n,r,o){lt(e);try{t(e,n,r,o)}catch(t){o._reject(t)}return o}function ut(t,e){var n=H(e);return t<=0||r(n)||i(n)?n:Q(t,n,new Vt)}function st(t,e){var n=H(e);return o(n)?n:X(t,n,new Vt)}function pt(t){return z(new Jt,t)}function ft(t){var e=new Lt(H,E(t));return z(e,t)}function ht(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return at(t,this,e)}function at(t,e,n){var r=new Nt(new Ut(t,e),E(n));return z(r,n)}function lt(t){if("function"!=typeof t)throw new TypeError("must provide a resolver function")}function yt(){var t="function"==typeof Promise&&Promise;return"undefined"!=typeof self?self.Promise=Yt:"undefined"!=typeof global&&(global.Promise=Yt),t}var vt=1,dt=2,mt=4,_t=dt|mt,wt=8,bt=16,gt={fulfilled:function(){},rejected:f},jt="undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process),At="function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver,kt=function(){var t=this;this.tasks=new Array(65536),this.length=0,this.drain=h(function(){return t._drain()})};kt.prototype.add=function(t){0===this.length&&this.drain(),this.tasks[this.length++]=t},kt.prototype._drain=function(){for(var t=this.tasks,e=0;e<this.length;++e)t[e].run(),t[e]=void 0;this.length=0};var Tt="unhandledRejection",Et="rejectionHandled",Pt=function(t,e){this.errors=[],this.emit=t,this.reportError=e};Pt.prototype.track=function(t){this.emit(Tt,t,t.value)||(0===this.errors.length&&setTimeout(v,1,this.reportError,this.errors),this.errors.push(t))},Pt.prototype.untrack=function(t){p(t),this.emit(Et,t)};var Ot="unhandledRejection",Rt=function(t,e,n){this.f=t,this.r=e,this.promise=n};Rt.prototype.fulfilled=function(t){g(this.f,t,this.promise)},Rt.prototype.rejected=function(t){return g(this.r,t,this.promise)};var xt=function(t,e){this.f=t,this.promise=e};xt.prototype.fulfilled=function(t){try{var e=this.f;this.promise._fulfill(e(t.value))}catch(t){this.promise._reject(t)}},xt.prototype.rejected=function(t){this.promise._become(t)};var St=function(t,e){this.f=t,this.promise=e};St.prototype.fulfilled=function(t){try{T(this.f,t.value,this.promise)}catch(t){this.promise._reject(t)}},St.prototype.rejected=function(t){this.promise._become(t)};var Mt=function(t){this.never=t};Mt.prototype.valueAt=function(t,e,n){n._fulfill(t)},Mt.prototype.fulfillAt=function(t,e,n){n._become(t)},Mt.prototype.rejectAt=function(t,e,n){n._become(t)},Mt.prototype.complete=function(t,e){0===t&&e._become(this.never())};var Nt=function(t,e){this.pending=0,this.results=e,this.mergeHandler=t};Nt.prototype.valueAt=function(t,e,n){this.results[e]=t,this.check(this.pending-1,n)},Nt.prototype.fulfillAt=function(t,e,n){this.valueAt(t.value,e,n)},Nt.prototype.rejectAt=function(t,e,n){n._become(t)},Nt.prototype.complete=function(t,e){this.check(this.pending+t,e)},Nt.prototype.check=function(t,e){this.pending=t,0===t&&this.mergeHandler.merge(e,this.results)};var Ht=new kt,Ct=new Pt(m(),function(t){throw t.value}),Kt=function(){};Kt.empty=function(){return K()},Kt.of=function(t){return V(t)};var Vt=function(t){function e(){t.call(this),this.ref=void 0,this.action=void 0,this.length=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.then=function(t,n){var r=this.near();return r===this?b(t,n,r,new e):r.then(t,n)},e.prototype.catch=function(t){var n=this.near();return n===this?b(void 0,t,n,new e):n.catch(t)},e.prototype.map=function(t){var n=this.near();return n===this?A(t,n,new e):n.map(t)},e.prototype.ap=function(t){var e=this.near(),n=t.near();return e===this?this.chain(function(t){return n.map(t)}):e.ap(n)},e.prototype.chain=function(t){var n=this.near();return n===this?k(t,n,new e):n.chain(t)},e.prototype.concat=function(t){var e=this.near(),n=t.near();return o(e)||i(n)?e:o(n)||i(e)?n:F([e,n])},e.prototype.toString=function(){return"[object "+this.inspect()+"]"},e.prototype.inspect=function(){var t=this.near();return t===this?"Promise { pending }":t.inspect()},e.prototype.near=function(){return this._isResolved()?(this.ref=this.ref.near(),this.ref):this},e.prototype.state=function(){return this._isResolved()?this.ref.near().state():vt},e.prototype._isResolved=function(){return void 0!==this.ref},e.prototype._when=function(t){this._runAction(t)},e.prototype._runAction=function(t){void 0===this.action?this.action=t:this[this.length++]=t},e.prototype._resolve=function(t){this._become(H(t))},e.prototype._fulfill=function(t){this._become(new Wt(t))},e.prototype._reject=function(t){this._isResolved()||this.__become(new Dt(t))},e.prototype._become=function(t){this._isResolved()||this.__become(t)},e.prototype.__become=function(t){this.ref=t===this?L():t,void 0!==this.action&&Ht.add(this)},e.prototype.run=function(){var t=this,e=this.ref.near();e._runAction(this.action),this.action=void 0;for(var n=0;n<this.length;++n)e._runAction(t[n]),t[n]=void 0},e}(Kt),Wt=function(t){function e(e){t.call(this),this.value=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.then=function(t){return"function"==typeof t?b(t,void 0,this,new Vt):this},e.prototype.catch=function(){return this},e.prototype.map=function(t){return A(t,this,new Vt)},e.prototype.ap=function(t){return t.map(this.value)},e.prototype.chain=function(t){return k(t,this,new Vt)},e.prototype.concat=function(){return this},e.prototype.toString=function(){return"[object "+this.inspect()+"]"},e.prototype.inspect=function(){return"Promise { fulfilled: "+this.value+" }"},e.prototype.state=function(){return dt},e.prototype.near=function(){return this},e.prototype._when=function(t){Ht.add(new zt(t,this))},e.prototype._runAction=function(t){t.fulfilled(this)},e}(Kt),Dt=function(t){function e(e){t.call(this),this.value=e,this._state=mt,Ct.track(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.then=function(t,e){return"function"==typeof e?this.catch(e):this},e.prototype.catch=function(t){return b(void 0,t,this,new Vt)},e.prototype.map=function(){return this},e.prototype.ap=function(){return this},e.prototype.chain=function(){return this},e.prototype.concat=function(){return this},e.prototype.toString=function(){return"[object "+this.inspect()+"]"},e.prototype.inspect=function(){return"Promise { rejected: "+this.value+" }"},e.prototype.state=function(){return this._state},e.prototype.near=function(){return this},e.prototype._when=function(t){Ht.add(new zt(t,this))},e.prototype._runAction=function(t){t.rejected(this)&&Ct.untrack(this)},e}(Kt),Ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.then=function(){return this},e.prototype.catch=function(){return this},e.prototype.map=function(){return this},e.prototype.ap=function(){return this},e.prototype.chain=function(){return this},e.prototype.concat=function(t){return t},e.prototype.toString=function(){return"[object "+this.inspect()+"]"},e.prototype.inspect=function(){return"Promise { never }"},e.prototype.state=function(){return vt|wt},e.prototype.near=function(){return this},e.prototype._when=function(){},e.prototype._runAction=function(){},e}(Kt),qt={merge:function(t,e){t._fulfill(e)}},zt=function(t,e){this.action=t,this.promise=e};zt.prototype.run=function(){this.promise._runAction(this.action)};var Bt=function(t,e){this.time=t,this.promise=e};Bt.prototype.fulfilled=function(t){setTimeout(U,this.time,t,this.promise)},Bt.prototype.rejected=function(t){this.promise._become(t)};var Gt=function(t){function e(n){t.call(this),this.message=n,this.name=e.name,"function"==typeof t.captureStackTrace&&t.captureStackTrace(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),It=function(t,e){this.timer=t,this.promise=e};It.prototype.fulfilled=function(t){clearTimeout(this.timer),this.promise._become(t)},It.prototype.rejected=function(t){return clearTimeout(this.timer),this.promise._become(t),!1};var Jt=function(){this.pending=0};Jt.prototype.valueAt=function(t,e,n){n._fulfill(t)},Jt.prototype.fulfillAt=function(t,e,n){n._become(t)},Jt.prototype.rejectAt=function(t,e,n){p(t),this.check(this.pending-1,n)},Jt.prototype.complete=function(t,e){this.check(this.pending+t,e)},Jt.prototype.check=function(t,e){this.pending=t,0===t&&e._reject(new RangeError("No fulfilled promises in input"))};var Lt=function(t,e){this.pending=0,this.results=e,this.resolve=t};Lt.prototype.valueAt=function(t,e,n){this.settleAt(this.resolve(t),e,n)},Lt.prototype.fulfillAt=function(t,e,n){this.settleAt(t,e,n)},Lt.prototype.rejectAt=function(t,e,n){p(t),this.settleAt(t,e,n)},Lt.prototype.settleAt=function(t,e,n){this.results[e]=t,this.check(this.pending-1,n)},Lt.prototype.complete=function(t,e){this.check(this.pending+t,e)},Lt.prototype.check=function(t,e){this.pending=t,0===t&&e._fulfill(this.results)};var Qt=function(t,e,n){this.resolve=t,this.iterator=e,this.promise=n};Qt.prototype.run=function(){this.step(this.iterator.next,void 0)},Qt.prototype.step=function(t,e){try{this.handle(t.call(this.iterator,e))}catch(t){this.promise._reject(t)}},Qt.prototype.handle=function(t){return t.done?this.promise._resolve(t.value):void this.resolve(t.value)._runAction(this)},Qt.prototype.fulfilled=function(t){this.step(this.iterator.next,t.value)},Qt.prototype.rejected=function(t){return this.step(this.iterator.throw,t.value),!0};var Ut=function(t,e){this.f=t,this.c=e,this.promise=void 0,this.args=void 0};Ut.prototype.merge=function(t,e){this.promise=t,this.args=e,Ht.add(this)},Ut.prototype.run=function(){try{this.promise._resolve(this.f.apply(this.c,this.args))}catch(t){this.promise._reject(t)}};var Xt=[],Yt=function(t){function e(e){t.call(this),ct(Z,e,void 0,Xt,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Vt);Yt.resolve=H,Yt.reject=C,Yt.all=D,Yt.race=F,"function"!=typeof Promise&&yt(),t.resolve=H,t.reject=C,t.future=W,t.never=K,t.fulfill=V,t.all=D,t.race=F,t.isFulfilled=n,t.isRejected=r,t.isSettled=o,t.isPending=e,t.isNever=i,t.getValue=u,t.getReason=s,t.coroutine=et,t.fromNode=rt,t.runNode=ot,t.runPromise=it,t.delay=ut,t.timeout=st,t.any=pt,t.settle=ft,t.merge=ht,t.shim=yt,t.Promise=Yt,Object.defineProperty(t,"__esModule",{value:!0})});